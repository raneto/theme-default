!function(o,e,t){o.widget("b4m.ghostDown",{editor:null,markdown:null,html:null,converter:null,_create:function(){this.converter=new e.converter,this.editor=t.fromTextArea(this.element.find("textarea")[0],{mode:"markdown",tabMode:"indent",lineWrapping:!0}),this.editor.on("change",o.proxy(function(){this._updatePreview()},this)),o(".entry-markdown header, .entry-preview header",this.element).click(function(e){o(".entry-markdown, .entry-preview",this.element).removeClass("active"),o(e.target,this.element).closest("section").addClass("active")}),o(".CodeMirror-scroll",this.element).on("scroll",o.proxy(function(e){this._syncScroll(e)},this)),o(".CodeMirror-scroll",this.element).scroll(function(e){10<o(e.target).scrollTop()?o(".entry-markdown",this.element).addClass("scrolling"):o(".entry-markdown",this.element).removeClass("scrolling")}),o(".entry-preview-content",this.element).scroll(function(e){10<o(".entry-preview-content",o(e.target).scrollTop()).scrollTop()?o(".entry-preview",this.element).addClass("scrolling"):o(".entry-preview",this.element).removeClass("scrolling")}),this._updatePreview()},_updatePreview:function(){var e=this.element.find(".rendered-markdown");this.markdown=this.editor.getValue(),this.html=this.converter.makeHtml(this.markdown),e.html(this.html),this._updateWordCount()},getHtml:function(){return this.html},getMarkdown:function(){return this.markdown},_syncScroll:function(e){var e=o(e.target),t=o(".entry-preview-content"),r=o(".CodeMirror-sizer"),n=o(".rendered-markdown"),r=r.height()-e.height(),n=(n.height()-t.height())/r,r=e.scrollTop()*n;t.scrollTop(r)},_updateWordCount:function(){var e=this.element.find(".entry-word-count"),t=this.markdown;t.length&&e.html(t.match(/\S+/g).length+" words")}})}(jQuery,Showdown,CodeMirror);